# 邮件解析HTTP服务 - 任务列表

## 任务 1: 项目初始化和配置模块

- [x] 1.1 安装依赖：express, uuid
- [x] 1.2 创建 `src/config.js` 配置模块，读取环境变量
- [x] 1.3 创建 `src/index.js` 应用入口，初始化 Express 服务器
- [x] 1.4 添加启动脚本到 package.json

**验收标准**: 2.1 服务提供 POST /parse 端点接收邮件数据

## 任务 2: 认证中间件

- [x] 2.1 创建 `src/middleware/auth.js` Token 验证中间件
- [x] 2.2 实现 Bearer Token 提取和验证逻辑
- [x] 2.3 在应用中注册认证中间件

**验收标准**: 1.1, 1.2, 1.3, 1.4

## 任务 3: 邮件解析服务

- [x] 3.1 创建 `src/services/emailParser.js` 邮件解析服务
- [x] 3.2 实现地址格式化函数（确保包含 name 和 address）
- [x] 3.3 封装 postal-mime 解析逻辑

**验收标准**: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 4.1, 4.2, 4.3

## 任务 4: 附件存储服务

- [x] 4.1 创建 `src/services/attachmentStorage.js` 附件存储服务
- [x] 4.2 实现附件保存功能（生成 UUID、写入文件、记录元数据）
- [x] 4.3 实现附件检索功能
- [x] 4.4 实现附件大小检查功能

**验收标准**: 5.1, 5.4, 6.1, 6.2

## 任务 5: 邮件解析控制器

- [x] 5.1 创建 `src/controllers/parse.js` 解析控制器
- [x] 5.2 实现请求体验证
- [x] 5.3 实现邮件解析和附件处理逻辑
- [x] 5.4 实现超限附件标记逻辑
- [x] 5.5 注册 POST /parse 路由

**验收标准**: 2.2, 2.3, 2.4, 2.5, 6.3, 6.4, 7.1, 7.2

## 任务 6: 附件下载控制器

- [x] 6.1 创建 `src/controllers/attachment.js` 附件控制器
- [x] 6.2 实现附件下载逻辑（设置响应头、返回文件流）
- [x] 6.3 实现附件不存在/过期的错误处理
- [x] 6.4 注册 GET /attachments/:id 路由

**验收标准**: 5.2, 5.3, 5.5

## 任务 7: 过期清理工具

- [x] 7.1 创建 `src/utils/cleanup.js` 清理工具
- [x] 7.2 实现定时清理逻辑（每 10 分钟检查一次）
- [x] 7.3 在应用启动时初始化清理定时器

**验收标准**: 5.4

## 任务 8: 错误处理完善

- [x] 8.1 添加全局错误处理中间件
- [x] 8.2 确保所有错误响应格式一致

**验收标准**: 7.3, 7.4
